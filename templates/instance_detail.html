{{define "content"}}
<div class="header-row">
    <h1>{{.Instance.Name}}</h1>
    <a href="/" class="btn btn-secondary">Back to Dashboard</a>
</div>

<div class="card">
    <div class="detail-grid">
        <div class="detail-item">
            <span class="detail-label">ID</span>
            <span class="detail-value mono">{{.Instance.ID}}</span>
        </div>
        <div class="detail-item">
            <span class="detail-label">Status</span>
            <span class="badge {{statusBadge .Instance.Status}}">{{.Instance.Status}}</span>
        </div>
        <div class="detail-item">
            <span class="detail-label">Port</span>
            <span class="detail-value">{{.Instance.Port}}</span>
        </div>
        <div class="detail-item">
            <span class="detail-label">Container ID</span>
            <span class="detail-value mono">{{if .Instance.ContainerID}}{{.Instance.ContainerID}}{{else}}-{{end}}</span>
        </div>
        <div class="detail-item">
            <span class="detail-label">Created</span>
            <span class="detail-value">{{.Instance.CreatedAt.Format "2006-01-02 15:04:05"}}</span>
        </div>
        <div class="detail-item">
            <span class="detail-label">Updated</span>
            <span class="detail-value">{{.Instance.UpdatedAt.Format "2006-01-02 15:04:05"}}</span>
        </div>
    </div>

    {{if .Instance.ErrorMsg}}
    <div class="alert alert-error">{{.Instance.ErrorMsg}}</div>
    {{end}}

    <div class="detail-actions" id="instance-actions">
        {{if eq .Instance.Status "running"}}
        <a href="/instance/{{.Instance.ID}}/" target="_blank" class="btn btn-success" title="Only one Web UI can be active at a time">Open Web UI</a>
        <a href="/instances/{{.Instance.ID}}/terminal" target="_blank" class="btn btn-secondary">Terminal</a>
        <button hx-post="/instances/{{.Instance.ID}}/stop"
                hx-target="#instance-actions" hx-swap="outerHTML"
                hx-disabled-elt="this"
                class="btn btn-warning"><span class="htmx-indicator spinner"></span>Stop</button>
        <button hx-post="/instances/{{.Instance.ID}}/restart"
                hx-target="#instance-actions" hx-swap="outerHTML"
                hx-disabled-elt="this"
                class="btn btn-secondary"><span class="htmx-indicator spinner"></span>Restart</button>
        {{else}}
        <button hx-post="/instances/{{.Instance.ID}}/start"
                hx-target="#instance-actions" hx-swap="outerHTML"
                hx-disabled-elt="this"
                class="btn btn-primary"><span class="htmx-indicator spinner"></span>Start</button>
        {{end}}
        <button hx-delete="/instances/{{.Instance.ID}}"
                hx-confirm="确定要删除此实例吗？这将永久销毁容器及其数据。"
                class="btn btn-danger">删除实例</button>
    </div>
</div>

<div class="card">
    <h2>Container Logs</h2>
    <div class="log-controls">
        <button onclick="reconnectLogs()" class="btn btn-sm btn-secondary">Reconnect</button>
    </div>
    <pre class="log-output" id="log-output">Connecting...</pre>
</div>
<script>
var _detailLogsWS = null;
function connectLogs() {
    var el = document.getElementById('log-output');
    if (_detailLogsWS) { _detailLogsWS.close(); }
    var proto = location.protocol === 'https:' ? 'wss:' : 'ws:';
    _detailLogsWS = new WebSocket(proto + '//' + location.host + '/instances/{{.Instance.ID}}/logs/ws');
    _detailLogsWS.onopen = function() { el.textContent = ''; };
    _detailLogsWS.onmessage = function(e) {
        el.textContent += e.data;
        el.scrollTop = el.scrollHeight;
    };
    _detailLogsWS.onclose = function() { el.textContent += '\n[Connection closed]'; };
    _detailLogsWS.onerror = function() { el.textContent += '\n[Connection error]'; };
}
function reconnectLogs() {
    document.getElementById('log-output').textContent = 'Connecting...';
    connectLogs();
}
connectLogs();
</script>

<div class="card">
    <h2>Configuration</h2>
    <p class="hint">环境变量和配置文件从 <a href="/settings">全局设置</a> 统一注入到所有实例。</p>
</div>
{{end}}
