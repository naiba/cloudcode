{{define "content"}}
<div class="header-row">
    <h1>Instances</h1>
    <a href="/instances/new" class="btn btn-primary">+ New Instance</a>
</div>

{{if not .Instances}}
<div class="empty-state">
    <p>No instances yet. Create your first OpenCode instance to get started.</p>
    <a href="/instances/new" class="btn btn-primary">Create Instance</a>
</div>
{{else}}
<div class="alert alert-info">Only one Web UI can be active at a time. Opening another instance will replace the current session.</div>
<div class="table-wrap">
    <table class="table" id="instances-table">
        <thead>
            <tr>
                <th>Name</th>
                <th>Status</th>
                <th>Port</th>
                <th>Created</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {{range .Instances}}
            {{template "instance_row" .}}
            {{end}}
        </tbody>
    </table>
</div>
{{end}}

<dialog id="log-modal">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px">
        <h2>Container Logs</h2>
        <button onclick="closeLogs()" class="btn btn-sm btn-secondary">Close</button>
    </div>
    <pre class="log-output" id="log-modal-content"></pre>
</dialog>
<script>
var _logsWS = null;
function openLogs(id) {
    var el = document.getElementById('log-modal-content');
    el.textContent = 'Connecting...';
    document.getElementById('log-modal').showModal();
    if (_logsWS) { _logsWS.close(); _logsWS = null; }
    var proto = location.protocol === 'https:' ? 'wss:' : 'ws:';
    _logsWS = new WebSocket(proto + '//' + location.host + '/instances/' + id + '/logs/ws');
    _logsWS.onopen = function() { el.textContent = ''; };
    _logsWS.onmessage = function(e) {
        el.textContent += e.data;
        el.scrollTop = el.scrollHeight;
    };
    _logsWS.onclose = function() { el.textContent += '\n[Connection closed]'; };
    _logsWS.onerror = function() { el.textContent += '\n[Connection error]'; };
}
function closeLogs() {
    if (_logsWS) { _logsWS.close(); _logsWS = null; }
    document.getElementById('log-modal').close();
}
</script>
{{end}}
