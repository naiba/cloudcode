{{define "content"}}
<div class="header-row">
    <h1>Instances</h1>
    <a href="/instances/new" class="btn btn-primary">+ New Instance</a>
</div>

{{if not .Instances}}
<div class="empty-state">
    <svg class="empty-state-icon" xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="2" width="20" height="8" rx="2" ry="2"/><rect x="2" y="14" width="20" height="8" rx="2" ry="2"/><line x1="6" y1="6" x2="6.01" y2="6"/><line x1="6" y1="18" x2="6.01" y2="18"/></svg>
    <p>No instances yet. Create your first OpenCode instance to get started.</p>
    <a href="/instances/new" class="btn btn-primary">Create Instance</a>
</div>
{{else}}
<div class="instance-grid">
    {{range .Instances}}
    {{template "instance_row" .}}
    {{end}}
</div>
{{end}}

<dialog id="log-modal">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px">
        <h2>Container Logs</h2>
        <button onclick="closeLogs()" class="btn btn-sm btn-secondary">Close</button>
    </div>
    <pre class="log-output" id="log-modal-content"></pre>
</dialog>
<script>
var _logsWS = null;
function openLogs(id) {
    var el = document.getElementById('log-modal-content');
    el.textContent = 'Connecting...';
    document.getElementById('log-modal').showModal();
    if (_logsWS) { _logsWS.close(); _logsWS = null; }
    var proto = location.protocol === 'https:' ? 'wss:' : 'ws:';
    _logsWS = new WebSocket(proto + '//' + location.host + '/instances/' + id + '/logs/ws');
    _logsWS.onopen = function() { el.textContent = ''; };
    _logsWS.onmessage = function(e) {
        el.textContent += e.data;
        el.scrollTop = el.scrollHeight;
    };
    _logsWS.onclose = function() { el.textContent += '\n[Connection closed]'; };
    _logsWS.onerror = function() { el.textContent += '\n[Connection error]'; };
}
function closeLogs() {
    if (_logsWS) { _logsWS.close(); _logsWS = null; }
    document.getElementById('log-modal').close();
}
</script>
{{end}}
